{% extends 'base.html' %}
{% block title %}Historique - FactGuard{% endblock %}
{% block page_title %}Historique des analyses{% endblock %}

{% block content %}
<div class="bg-white rounded-xl shadow-lg">
    <div class="px-6 py-4 border-b border-gray-200">
        <h5 class="text-lg font-semibold text-teal-900">
            <i class="fas fa-history mr-2"></i>
            Vos {{ total_count }} analyses
            <span class="text-sm text-gray-500 font-normal">
                (<span id="showing-count">5</span> affichées)
            </span>
        </h5>
    </div>
    
    <div class="p-6">
        {% if total_count > 0 %}
            <!-- Section des 5 dernières analyses (affichées par défaut) -->
            <div id="recent-analyses" class="space-y-4">
                {% for analysis in analyses_recent %}
                    <div class="border-l-4 border-{{ analysis.content_type|default:'teal' }}-500 bg-gray-50 p-4 rounded-r-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="{{ analysis.type_icon }} text-teal-600 mr-2"></i>
                                    <span class="text-sm font-medium text-gray-800">{{ analysis.type_display }}</span>
                                    <span class="ml-2 px-2 py-1 text-xs bg-teal-100 text-teal-800 rounded">
                                        {{ analysis.reliability_level }}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-700 mb-1">
                                    {{ analysis.text|truncatechars:100 }}
                                </p>
                                <p class="text-xs text-gray-500">
                                    {{ analysis.created_at|date:"d/m/Y à H:i" }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold text-teal-600">
                                    {% widthratio analysis.confidence_score 1 100 %}%
                                </p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Section de toutes les analyses (cachée par défaut) -->
            <div id="all-analyses" class="space-y-4 hidden">
                {% for analysis in analyses_all %}
                    <div class="border-l-4 border-{{ analysis.content_type|default:'teal' }}-500 bg-gray-50 p-4 rounded-r-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="{{ analysis.type_icon }} text-teal-600 mr-2"></i>
                                    <span class="text-sm font-medium text-gray-800">{{ analysis.type_display }}</span>
                                    <span class="ml-2 px-2 py-1 text-xs bg-teal-100 text-teal-800 rounded">
                                        {{ analysis.reliability_level }}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-700 mb-1">
                                    {{ analysis.text|truncatechars:100 }}
                                </p>
                                <p class="text-xs text-gray-500">
                                    {{ analysis.created_at|date:"d/m/Y à H:i" }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold text-teal-600">
                                    {% widthratio analysis.confidence_score 1 100 %}%
                                </p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Bouton Voir plus / Voir moins -->
            {% if total_count > 5 %}
                <div class="text-center mt-6">
                    <button id="toggle-btn" class="bg-teal-600 hover:bg-teal-700 text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center mx-auto">
                        <i class="fas fa-chevron-down mr-2"></i>
                        <span>Voir plus ({{ total_count|add:"-5" }} restantes)</span>
                    </button>
                </div>
            {% endif %}
            
        {% else %}
            <div class="text-center py-8">
                <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-lg font-medium text-gray-700 mb-2">Aucune analyse pour le moment</h3>
                <p class="text-gray-500 mb-6">Commencez par analyser un contenu</p>
                <a href="{% url 'dashboard:analyzer' %}" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Nouvelle analyse
                </a>
            </div>
        {% endif %}
    </div>
</div>

<!-- JavaScript pour le bouton Plus/Moins -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggle-btn');
    const recentAnalyses = document.getElementById('recent-analyses');
    const allAnalyses = document.getElementById('all-analyses');
    const showingCount = document.getElementById('showing-count');
    
    if (toggleBtn) {
        toggleBtn.addEventListener('click', function() {
            const icon = this.querySelector('i');
            const text = this.querySelector('span');
            
            if (allAnalyses.classList.contains('hidden')) {
                // Afficher toutes les analyses
                allAnalyses.classList.remove('hidden');
                recentAnalyses.classList.add('hidden');
                icon.className = 'fas fa-chevron-up mr-2';
                text.textContent = 'Voir moins';
                showingCount.textContent = '{{ total_count }}';
            } else {
                // Afficher seulement les 5 dernières
                allAnalyses.classList.add('hidden');
                recentAnalyses.classList.remove('hidden');
                icon.className = 'fas fa-chevron-down mr-2';
                text.textContent = 'Voir plus ({{ total_count|add:"-5" }} restantes)';
                showingCount.textContent = '5';
            }
        });
    }
});
</script>
{% endblock %}

