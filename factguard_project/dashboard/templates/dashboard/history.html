{% extends 'base.html' %}
{% load static %}

{% block title %}Historique - FactGuard{% endblock %}

{% block page_title %}Historique des analyses{% endblock %}

{% block content %}
   <section class="bg-white rounded-xl shadow-lg border border-teal-100">
        <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-teal-50 to-cyan-50">
            <h5 class="text-lg font-semibold text-teal-900 flex items-center">
                <i class="fas fa-activity mr-3 text-teal-600"></i>
                Activité récente
            </h5>
        </div>
        <div class="p-6">
            <div class="space-y-3">
                <div class="flex items-center justify-between p-4 bg-teal-50 rounded-lg border-l-4 border-teal-500 hover:bg-teal-100 transition-colors">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-teal-500 rounded-full mr-4 animate-pulse"></div>
                        <div>
                            <span class="text-sm font-medium text-gray-800">Analyse de texte</span>
                            <p class="text-xs text-gray-600">Article de presse - Score: 87%</p>
                        </div>
                    </div>
                    <span class="text-xs text-teal-600 font-medium bg-teal-100 px-2 py-1 rounded-full">Il y a 23 min</span>
                </div>
                
                <div class="flex items-center justify-between p-4 bg-cyan-50 rounded-lg border-l-4 border-cyan-500 hover:bg-cyan-100 transition-colors">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-cyan-500 rounded-full mr-4"></div>
                        <div>
                            <span class="text-sm font-medium text-gray-800">Analyse de lien</span>
                            <p class="text-xs text-gray-600">Site web d'actualités - Score: 92%</p>
                        </div>
                    </div>
                    <span class="text-xs text-cyan-600 font-medium bg-cyan-100 px-2 py-1 rounded-full">Il y a 1h 15min</span>
                </div>
                
                <div class="flex items-center justify-between p-4 bg-emerald-50 rounded-lg border-l-4 border-emerald-500 hover:bg-emerald-100 transition-colors">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-emerald-500 rounded-full mr-4"></div>
                        <div>
                            <span class="text-sm font-medium text-gray-800">Analyse d'image</span>
                            <p class="text-xs text-gray-600">Capture d'écran - Score: 71%</p>
                        </div>
                    </div>
                    <span class="text-xs text-emerald-600 font-medium bg-emerald-100 px-2 py-1 rounded-full">Il y a 2h 30min</span>
                </div>

                <div class="flex items-center justify-between p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400 hover:bg-orange-100 transition-colors">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-orange-400 rounded-full mr-4"></div>
                        <div>
                            <span class="text-sm font-medium text-gray-800">Analyse de texte</span>
                            <p class="text-xs text-gray-600">Post réseaux sociaux - Score: 43%</p>
                        </div>
                    </div>
                    <span class="text-xs text-orange-600 font-medium bg-orange-100 px-2 py-1 rounded-full">Il y a 3h 45min</span>
                </div>
            </div>
            
            <!-- Bouton voir plus -->
            <div class="mt-6 text-center">
                <button class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 text-white font-medium rounded-lg transition-all duration-200 shadow-md hover:shadow-lg">
                    <i class="fas fa-history mr-2"></i>
                    Voir l'historique complet
                </button>
            </div>
        </div>
    </section>
{% endblock %}
=======
{% block title %}Historique - FactGuard{% endblock %}
{% block page_title %}Historique des analyses{% endblock %}

{% block content %}
<div class="bg-white rounded-xl shadow-lg">
    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <h5 class="text-lg font-semibold text-teal-900">
            <i class="fas fa-history mr-2"></i>
            Vos {{ total_count }} analyses
            <span class="text-sm text-gray-500 font-normal">
                (<span id="showing-count">{% if total_count <= 5 %}{{ total_count }}{% else %}5{% endif %}</span> affichées)
            </span>
        </h5>
        
        <!-- Bouton Vider l'historique -->
        {% if total_count > 0 %}
            <a href="{% url 'dashboard:clear_history' %}" 
               class="bg-red-600 hover:bg-red-700 text-white text-sm px-4 py-2 rounded-lg transition-colors">
                <i class="fas fa-trash mr-2"></i>Vider l'historique
            </a>
        {% endif %}
    </div>
    
    <div class="p-6">
        {% if total_count > 0 %}
            <!-- Section des 5 dernières analyses -->
            <div id="recent-analyses" class="space-y-4">
                {% for analysis in analyses_recent %}
                    <div class="border-l-4 border-{{ analysis.content_type|default:'teal' }}-500 bg-gray-50 p-4 rounded-r-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="{{ analysis.type_icon }} text-teal-600 mr-2"></i>
                                    <span class="text-sm font-medium text-gray-800">{{ analysis.type_display }}</span>
                                    <span class="ml-2 px-2 py-1 text-xs bg-teal-100 text-teal-800 rounded">
                                        {{ analysis.reliability_level }}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-700 mb-1">
                                    {{ analysis.text|truncatechars:100 }}
                                </p>
                                <p class="text-xs text-gray-500">
                                    {{ analysis.created_at|date:"d/m/Y à H:i" }}
                                </p>
                            </div>
                            <div class="text-right flex items-center space-x-3">
                                <p class="text-lg font-bold text-teal-600">
                                    {% widthratio analysis.confidence_score 1 100 %}%
                                </p>
                                <!-- Bouton supprimer cette analyse -->
                                <a href="{% url 'dashboard:delete_analysis' analysis.id %}" 
                                   class="text-red-500 hover:text-red-700 transition-colors"
                                   title="Supprimer cette analyse">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Section de toutes les analyses (cachée par défaut) -->
            <div id="all-analyses" class="space-y-4 hidden">
                {% for analysis in analyses_all %}
                    <div class="border-l-4 border-{{ analysis.content_type|default:'teal' }}-500 bg-gray-50 p-4 rounded-r-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="{{ analysis.type_icon }} text-teal-600 mr-2"></i>
                                    <span class="text-sm font-medium text-gray-800">{{ analysis.type_display }}</span>
                                    <span class="ml-2 px-2 py-1 text-xs bg-teal-100 text-teal-800 rounded">
                                        {{ analysis.reliability_level }}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-700 mb-1">
                                    {{ analysis.text|truncatechars:100 }}
                                </p>
                                <p class="text-xs text-gray-500">
                                    {{ analysis.created_at|date:"d/m/Y à H:i" }}
                                </p>
                            </div>
                            <div class="text-right flex items-center space-x-3">
                                <p class="text-lg font-bold text-teal-600">
                                    {% widthratio analysis.confidence_score 1 100 %}%
                                </p>
                                <!-- Bouton supprimer cette analyse -->
                                <a href="{% url 'dashboard:delete_analysis' analysis.id %}" 
                                   class="text-red-500 hover:text-red-700 transition-colors"
                                   title="Supprimer cette analyse">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Bouton Voir plus / Voir moins -->
            {% if total_count > 5 %}
                <div class="text-center mt-6">
                    <button id="toggle-btn" class="bg-teal-600 hover:bg-teal-700 text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center mx-auto">
                        <i class="fas fa-chevron-down mr-2"></i>
                        <span>Voir plus ({{ total_count|add:"-5" }} restantes)</span>
                    </button>
                </div>
            {% endif %}
            
        {% else %}
            <div class="text-center py-8">
                <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-lg font-medium text-gray-700 mb-2">Aucune analyse pour le moment</h3>
                <p class="text-gray-500 mb-6">Commencez par analyser un contenu</p>
                <a href="{% url 'dashboard:analyzer' %}" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Nouvelle analyse
                </a>
            </div>
        {% endif %}
    </div>
</div>

<!-- JavaScript pour le bouton Plus/Moins (inchangé) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggle-btn');
    const recentAnalyses = document.getElementById('recent-analyses');
    const allAnalyses = document.getElementById('all-analyses');
    const showingCount = document.getElementById('showing-count');
    
    if (toggleBtn) {
        toggleBtn.addEventListener('click', function() {
            const icon = this.querySelector('i');
            const text = this.querySelector('span');
            
            if (allAnalyses.classList.contains('hidden')) {
                allAnalyses.classList.remove('hidden');
                recentAnalyses.classList.add('hidden');
                icon.className = 'fas fa-chevron-up mr-2';
                text.textContent = 'Voir moins';
                showingCount.textContent = '{{ total_count }}';
            } else {
                allAnalyses.classList.add('hidden');
                recentAnalyses.classList.remove('hidden');
                icon.className = 'fas fa-chevron-down mr-2';
                text.textContent = 'Voir plus ({{ total_count|add:"-5" }} restantes)';
                showingCount.textContent = '5';
            }
        });
    }
});
</script>
{% endblock %}

