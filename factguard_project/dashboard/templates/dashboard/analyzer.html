{% extends 'base.html' %}
{% load static %}

{% block title %}Analyseur - FactGuard{% endblock %}

{% block page_title %}Analyseur de contenu{% endblock %}

{% block content %}
    <!-- Sélection du type de contenu -->
    <div class="grid grid-cols-3 gap-4">
        <button type="button" data-type="text" class="content-type-btn border-2 border-teal-300 rounded-lg p-6 flex flex-col items-center justify-center hover:bg-teal-50 transition-all duration-200 group">
            <i class="fas fa-file-alt text-3xl mb-3 text-teal-600 group-hover:text-teal-700"></i>
            <span class="font-semibold text-teal-700">Texte</span>
        </button>
        <button type="button" data-type="link" class="content-type-btn border-2 border-teal-300 rounded-lg p-6 flex flex-col items-center justify-center hover:bg-teal-50 transition-all duration-200 group">
            <i class="fas fa-link text-3xl mb-3 text-teal-500 group-hover:text-teal-600"></i>
            <span class="font-semibold text-teal-600">Lien</span>
        </button>
        <button type="button" data-type="image" class="content-type-btn border-2 border-teal-300 rounded-lg p-6 flex flex-col items-center justify-center hover:bg-teal-50 transition-all duration-200 group">
            <i class="fas fa-image text-3xl mb-3 text-teal-400 group-hover:text-teal-500"></i>
            <span class="font-semibold text-teal-500">Image</span>
        </button>
    </div>

    <!-- Formulaire d'analyse -->
    <form id="analysis-form" method="post" enctype="multipart/form-data" class="bg-white rounded-xl shadow-lg p-6 space-y-4">
        {% csrf_token %}
        <input type="hidden" name="content_type" id="content_type" value="text">

        <!-- Input Texte -->
        <div id="text-input" class="input-section">
            <textarea name="text_to_analyze" placeholder="Collez ici le texte à analyser..." rows="6"
                class="w-full p-4 border-2 border-teal-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent resize-vertical"></textarea>
        </div>

        <!-- Input Lien -->
        <div id="link-input" class="input-section hidden">
            <input type="url" name="content" placeholder="https://example.com/article"
                class="w-full p-4 border-2 border-teal-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">

        </div>

        <!-- Input Image -->
        <div id="image-input" class="input-section hidden">
            <div class="border-2 border-dashed border-teal-300 rounded-lg p-8 text-center bg-teal-50 hover:bg-teal-100 transition-colors">
                <label for="image-upload" class="cursor-pointer flex flex-col items-center justify-center text-teal-700">
                    <i class="fas fa-image text-5xl mb-3 text-teal-500"></i>
                    <span class="text-lg font-medium">Sélectionnez une image ou glissez-déposez ici</span>
                </label>
                <input id="image-upload" type="file" name="image" accept="image/*" class="hidden">
            </div>
        </div>

        <!-- Bouton d'analyse -->
        <button type="submit" class="w-full flex items-center justify-center gap-2 py-4 px-6 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 text-white font-bold text-lg rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
            <i class="fas fa-bolt"></i>
            Analyser
        </button>
    </form>

    <!-- Résultats de l'analyse -->
    {% if analysis_result %}
        <section class="bg-white rounded-xl shadow-lg p-6 mt-6">
            <h2 class="text-2xl font-semibold mb-4 text-teal-800 flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                Résultat de l'analyse
            </h2>
            <div class="space-y-3 text-gray-700">
                <pre class="whitespace-pre-wrap">{{ analysis_result }}</pre>
            </div>
        </section>
    {% endif %}

    <!-- Messages d'erreur -->
    {% if error_message %}
        <section class="bg-red-50 border border-red-200 rounded-lg p-4 mt-4">
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                <p class="text-red-700 font-semibold">{{ error_message }}</p>
            </div>
        </section>
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const buttons = document.querySelectorAll('.content-type-btn');
        const contentTypeInput = document.getElementById('content_type');
        const inputs = {
            text: document.getElementById('text-input'),
            link: document.getElementById('link-input'),
            image: document.getElementById('image-input')
        };

        // Style pour bouton actif
        function setActiveButton(activeBtn) {
            buttons.forEach(btn => {
                btn.classList.remove('bg-teal-600', 'text-white', 'border-teal-600');
                btn.classList.add('border-teal-300');
            });
            activeBtn.classList.add('bg-teal-600', 'text-white', 'border-teal-600');
            activeBtn.classList.remove('border-teal-300');
        }

        // Set default active button (text)
        setActiveButton(document.querySelector('[data-type="text"]'));

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                setActiveButton(button);

                const type = button.getAttribute('data-type');
                contentTypeInput.value = type;

                // Affiche/cache les inputs correspondants
                Object.keys(inputs).forEach(key => {
                    if (key === type) {
                        inputs[key].classList.remove('hidden');
                    } else {
                        inputs[key].classList.add('hidden');
                    }
                });
            });
        });
    });
</script>
{% endblock %}