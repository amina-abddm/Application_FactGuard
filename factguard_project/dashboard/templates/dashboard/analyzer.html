{% extends 'base.html' %}
{% load static %}

{% block extra_css %}

<!-- Tailwind CSS CDN --> <script src="https://cdn.tailwindcss.com"></script>
{% endblock %}

{% block title %}Analyseur - FactGuard{% endblock %}

{% block content %}
<div class="flex min-h-screen">
<!-- Sidebar -->
<aside class="w-64 bg-gradient-to-b from-teal-800 to-cyan-800 p-6 text-white flex flex-col">
<div class="flex items-center mb-8">
<div class="p-3 bg-teal-600 rounded-xl mr-3">
<i class="fas fa-shield-alt"></i>
</div>
<span class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-teal-400 to-cyan-200">FactGuard</span>
</div>
<nav class="flex flex-col space-y-2">
<a href="{% url 'analyzer' %}" class="rounded-lg px-3 py-2 flex items-center bg-teal-700 text-white font-semibold hover:bg-teal-600">
<i class="fas fa-search mr-2"></i>Analyseur
</a>
<a href="{% url 'history' %}" class="rounded-lg px-3 py-2 flex items-center hover:bg-teal-800">
<i class="fas fa-history mr-2"></i>Historique
</a>
<a href="{% url 'statistics' %}" class="rounded-lg px-3 py-2 flex items-center hover:bg-teal-800">
<i class="fas fa-chart-bar mr-2"></i>Statistiques
</a>
</nav>
</aside>


    <!-- Main Content -->
    <main class="flex-1 bg-slate-50 min-h-screen flex flex-col">
        <header class="flex justify-between items-center px-8 py-4 bg-white/95 backdrop-blur-md shadow border-b border-teal-100">
            <h1 class="text-2xl font-semibold text-teal-900">Analyseur de contenu</h1>
            <div class="flex items-center gap-3 px-3 py-2 bg-teal-100 rounded-lg">
                <i class="fas fa-user text-teal-800"></i>
                <span class="font-medium text-teal-900">{{ user.get_full_name|default:user.username|default:'Utilisateur Demo' }}</span>
            </div>
        </header>

        <section class="px-8 py-6 flex flex-col gap-6 flex-grow overflow-auto">
            <!-- Sélection du type de contenu -->
            <div class="grid grid-cols-3 gap-4">
                <button type="button" data-type="text" class="content-type-btn border-2 border-teal-300 rounded-lg p-6 flex flex-col items-center justify-center hover:bg-teal-50 transition-all duration-200 group">
                    <i class="fas fa-file-alt text-3xl mb-3 text-teal-600 group-hover:text-teal-700"></i>
                    <span class="font-semibold text-teal-700">Texte</span>
                </button>
                <button type="button" data-type="link" class="content-type-btn border-2 border-teal-300 rounded-lg p-6 flex flex-col items-center justify-center hover:bg-teal-50 transition-all duration-200 group">
                    <i class="fas fa-link text-3xl mb-3 text-teal-500 group-hover:text-teal-600"></i>
                    <span class="font-semibold text-teal-600">Lien</span>
                </button>
                <button type="button" data-type="image" class="content-type-btn border-2 border-teal-300 rounded-lg p-6 flex flex-col items-center justify-center hover:bg-teal-50 transition-all duration-200 group">
                    <i class="fas fa-image text-3xl mb-3 text-teal-400 group-hover:text-teal-500"></i>
                    <span class="font-semibold text-teal-500">Image</span>
                </button>
            </div>

            <!-- Formulaire d'analyse -->
            <form id="analysis-form" method="post" enctype="multipart/form-data" class="bg-white rounded-xl shadow-lg p-6 space-y-4">
                {% csrf_token %}
                <input type="hidden" name="content_type" id="content_type" value="text">

                <!-- Input Texte -->
                <div id="text-input" class="input-section">
                    <textarea name="text_to_analyze" placeholder="Collez ici le texte à analyser..." rows="6"
                        class="w-full p-4 border-2 border-teal-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent resize-vertical"></textarea>
                </div>

                <!-- Input Lien -->
                <div id="link-input" class="input-section hidden">
                    <input type="url" name="content" placeholder="https://example.com/article"
                        class="w-full p-4 border-2 border-teal-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>

                <!-- Input Image -->
                <div id="image-input" class="input-section hidden">
                    <div class="border-2 border-dashed border-teal-300 rounded-lg p-8 text-center bg-teal-50 hover:bg-teal-100 transition-colors">
                        <label for="image-upload" class="cursor-pointer flex flex-col items-center justify-center text-teal-700">
                            <i class="fas fa-image text-5xl mb-3 text-teal-500"></i>
                            <span class="text-lg font-medium">Sélectionnez une image ou glissez-déposez ici</span>
                        </label>
                        <input id="image-upload" type="file" name="image" accept="image/*" class="hidden">
                    </div>
                </div>

                <!-- Bouton d'analyse -->
                <button type="submit" class="w-full flex items-center justify-center gap-2 py-4 px-6 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 text-white font-bold text-lg rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                    <i class="fas fa-bolt"></i>
                    Analyser
                </button>
            </form>

            <!-- Résultats de l'analyse -->
            {% if analysis_result %}
                <section class="bg-white rounded-xl shadow-lg p-6 mt-6">
                    <h2 class="text-2xl font-semibold mb-4 text-teal-800 flex items-center">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        Résultat de l'analyse
                    </h2>
                    <div class="space-y-3 text-gray-700">
                        <pre class="whitespace-pre-wrap">{{ analysis_result }}</pre>
                    </div>
                </section>
            {% endif %}

            <!-- Messages d'erreur -->
            {% if error_message %}
                <section class="bg-red-50 border border-red-200 rounded-lg p-4 mt-4">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                        <p class="text-red-700 font-semibold">{{ error_message }}</p>
                    </div>
                </section>
            {% endif %}
        </section>
    </main>
</div>

<!-- Script JavaScript pour la gestion des types de contenu -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const buttons = document.querySelectorAll('.content-type-btn');
        const contentTypeInput = document.getElementById('content_type');
        const inputs = {
            text: document.getElementById('text-input'),
            link: document.getElementById('link-input'),
            image: document.getElementById('image-input')
        };

        // Style pour bouton actif
        function setActiveButton(activeBtn) {
            buttons.forEach(btn => {
                btn.classList.remove('bg-teal-600', 'text-white', 'border-teal-600');
                btn.classList.add('border-teal-300');
            });
            activeBtn.classList.add('bg-teal-600', 'text-white', 'border-teal-600');
            activeBtn.classList.remove('border-teal-300');
        }

        // Set default active button (text)
        setActiveButton(document.querySelector('[data-type="text"]'));

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                setActiveButton(button);

                const type = button.getAttribute('data-type');
                contentTypeInput.value = type;

                // Affiche/cache les inputs correspondants
                Object.keys(inputs).forEach(key => {
                    if (key === type) {
                        inputs[key].classList.remove('hidden');
                    } else {
                        inputs[key].classList.add('hidden');
                    }
                });
            });
        });
    });
</script>
{% endblock %}
